!function(e){function n(){var n=[];return jQuery.each(jQuery("#facetList .EXLFacetContainer"),function(t,r){r=e(r),r.name=e(r).find('*[class*="EXLFacetTitleLabelPHolder"]').attr("class").replace("EXLFacetTitleLabelPHolder",""),r.values=[],e.each(r.find(".EXLFacet"),function(n,t){t=e(t),t.value=e(t).find("a").text().trim(),t.count=e(t).find("span").text().trim().replace(/\.|\,/g,"").replace(/\(/g,"").replace(/\)/g,""),r.values.push(t)}),n.push(r)}),n.getNames=function(){return e.map(n,function(e){return e.name})},n.getByName=function(e){return n.filter(function(n){return n.name===e})[0]},n}function t(){function n(){var e=jQuery(window.location.search.replace(/^\?/,"").split("&")).map(function(){var e=this,n=e.split("="),t={};return t[decodeURIComponent(n[0])]=decodeURIComponent(n[1]),t});return e.lookup=function(n){var t=[];return jQuery.each(e,function(r,a){var i=jQuery(Object.keys(a)).map(function(){var e=this,t=e.match(n.replace(/\(/g,"\\(").replace(/\)/g,"\\)"));return t?e:null}).filter(function(e){return null!=e})[0];i&&""!=i&&t.push(e[r][i])}),t},e}function t(){var e="";if(r()){var n=jQuery(window.location.search.replace(/^\?/,"").split("&")).map(function(){var e=this,n=e.split("="),t={};return t[decodeURIComponent(n[0])]=decodeURIComponent(n[1]),t});e=n.length>0?n[0].query.replace(/\,/g," "):""}else jQuery(l).each(function(n,t){l[n]=t,t.term.trim().length>0&&(e+=e.length>0?" AND ":"",e+="("+t.index+" "+t.precision+" "+t.term+")")}),jQuery(i).each(function(n,t){jQuery(Object.keys(t)).each(function(r,a){i[n]={index:a,term:t[a]},t[a].trim().length>0&&(e+=e.length>0?" AND ":"",e+="("+a+" exact "+t[a]+")")})});return e}function r(){return null!=window.location.href.match("dlSearch.do")}var a=n(),i=[];if(void 0!==a.lookup("ct")[0]){var o=a.lookup("fctN"),u=a.lookup("fctV");e(o).each(function(e,n){var t={};t[n]=e<=u.length?u[e]:"",i.push(t)})}var l=[];if(void 0!==a.lookup("mode")[0]&&"Basic"===a.lookup("mode")[0])e(a.lookup("freeText")).each(function(e,n){l.push({index:"any",precision:"contains",term:n})});else{e(a.lookup("freeText")).each(function(e){l.push({index:a.lookup("UI"+e)[0]||"any",precision:a.lookup("StartWith"+e)[0]||"contains",term:a.lookup("freeText"+e)[0]||""})});var s={};e(".EXLSearchFieldRibbonFormFieldsGroup2 input:visible,.EXLSearchFieldRibbonFormFieldsGroup2 select:visible").each(function(n,t){var r=e(t).attr("id").replace(/^.*[i|I]nput_/,"").replace(/_$/,"");s[r]=e(t).attr("name")}),e(Object.keys(s)).each(function(e,n){var t=n,r=a.lookup(s[t])[0]||"";l.push({index:t,precision:"contains",term:decodeURIComponent(r)})})}var c=parseInt(jQuery("#resultsNumbersTile em:first").text().replace(/[\s,]+/g,"").replace(/\.|\,/g,"")),d=parseInt(e("#resultsNumbersTile span:first").text().replace(/[^\d|-]*/g,"").split("-")[1]),f=1;return isNaN(d)?(d=10,f=1):(d=parseInt(e("#resultsNumbersTile span:first").text().replace(/[^\d|-]*/g,"").split("-")[1])-parseInt(e("#resultsNumbersTile span:first").text().replace(/[^\d|-]*/g,"").split("-")[0])+1,f=Math.floor(parseInt(e("#resultsNumbersTile span:first").text().replace(/[^\d|-]*/g,"").split("-")[1])/d)),l.toString=function(){return t()},{isDeeplinkSearch:r,count:c,step:d,page:f,type:a.lookup("mode")[0],tab:a.lookup("tab")[0],sorted_by:a.lookup("srt")[0],scope:a.lookup("scp.scps")[0],facets:i,query:l}}function r(e){var n=null,t=jQuery(jQuery(".EXLResult")[e]);return t.index=e,t.id=t.find(".EXLResultRecordId[name]").attr("name"),t.title=t.find(".EXLResultTitle").text().trim(),t.openUrl=t.find(".EXLMoreTab a").attr("href"),t.tabs=f(t),t.materialType=function(){return u(t)},t.getIt1=function(){return l(t)},t.getDedupedRecordIds=function(){return o(t.id).data()},t.isRemoteRecord=function(){return"TN"===t.id.substring(0,2)},t.isOnEShelf=function(){return-1!=t.find(".EXLMyShelfStar a").attr("href").search("fn=remove")},t.isDedupedRecord=function(){return a(t.id)},t.isFrbrRecord=function(){return i(t)},t.getData=function(){if(!n){var e=g(t.id,"json");e&&e.length>0&&(n=e[0])}return n},t.getPNX=function(e){return g(t.id,e)},t}function a(e){return-1!=e.search(/^dedupmrg/)}function i(e){return e.find(".EXLResultFRBR").length>0}function o(e){var n=[];return{data:function(){return 0===n.length&&a(e)&&jQuery.ajax({async:!1,type:"get",dataType:"json",data:{id:e},url:jQuery.PRIMO.parameters.base_path+"/helpers/dedup_records_helper.jsp"}).done(function(e){n=e}).fail(function(){console.log("You need the dedup_records_helper.jsp file")}),n}}}function u(e){return e.getData().display.type}function l(n){var t=n.tabs.getByName("ViewOnline"),r="",a=[],i=[];return t&&t.length>0&&(i=e(t.find('input[id*="getitonline1"]')).val().split(/&O\d=/),a=e.map(i,function(e){return e.match(/^delivery/)?e.replace(/delivery,.*?,/,""):void 0}),r=a.length>0?a[0]:""),r}function s(){return{by_record_id:function(n,t){if(void 0===n)throw"You must supply a record id";var r=void 0!==t&&void 0!==t.institution?t.institution:jQuery.PRIMO.session.view.code,a=void 0!==t&&void 0!==t.index?t.index:1,i=void 0!==t&&void 0!==t.bulkSize?t.bulkSize:10,o=[];return jQuery.get("/PrimoWebServices/xservice/search/brief?institution="+r+"&query=rid,contains,"+n+"&indx="+a+"&bulkSize="+i).done(function(n){o=e(b(n))}).fail(function(){console.log("error searching")}),o},by_query:function(n,t){var r=void 0!==t&&void 0!==t.institution?t.institution:jQuery.PRIMO.session.view.code,a=void 0!==t&&void 0!==t.index?t.index:1,i=void 0!==t&&void 0!==t.bulkSize?t.bulkSize:10;Array.isArray(n)?jQuery.each(n,function(e,t){n=0/0+t}):n="&query="+n;var o=[];return jQuery.ajax({async:!1,cache:!1,type:"get",dataType:"xml",url:"/PrimoWebServices/xservice/search/brief?institution="+r+"&indx="+a+"&bulkSize="+i+n}).done(function(n){o=e(b(n))}).fail(function(){console.log("error searching")}),o.length>0&&o[0].hasOwnProperty("JAGROOT")?o[0].JAGROOT.RESULT.DOCSET.DOC:(o.length>0&&o[0].hasOwnProperty("MESSAGE")&&console.log(o[0].MESSAGE),null)}}}function d(n,t){var r=null;if("number"==typeof t?r=n.find(".EXLResultTab")[t]:"string"==typeof t&&(r=n.find('.EXLResultTab:contains("'+t+'")'),0==r.length&&(r=n.find(".EXLResultTab[id*='"+t+"']")),0==r.length&&(r=n.find(".EXLResultTab[id*='"+t.toLowerCase()+"']")),(null==r||0==r.length)&&(r=e(n.tabs).find('a[title*="'+t+'"]').parent()),(null==r||0==r.length)&&(r=e(n).find('li[class*="'+t+'"]'))),null!==r){var a;a=void 0===jQuery(r).attr("name")?jQuery(r).attr("id").split("-")[1].replace("tab",""):jQuery(r).attr("name").trim();var i=null,o="Container-"+a.trim().toLowerCase().replace(/tab$/g,"")+"Tab";c=n.find('*[class*="'+o+'"]'),c.length>0&&(i=c),r.index=t,r.label=jQuery(r).find("a").text().trim(),r.name=a,r.container=i,r.isOpen=function(){return jQuery(r).hasClass("EXLResultSelectedTab")},r.close=function(){jQuery.PRIMO.session.view.isFullDisplay()||(n.find(".EXLResultSelectedTab").removeClass("EXLResultSelectedTab"),n.find(".EXLTabsRibbon").addClass("EXLTabsRibbonClosed"),r.container.hide())},r.open=function(e,t){defaults={reload:!1,headerContent:"",url:"#"};var r=jQuery.extend(defaults,t);if(currentTab=n.tabs.getByName(a),n.find(".EXLTabsRibbonClosed").removeClass("EXLTabsRibbonClosed"),n.find(".EXLResultSelectedTab").removeClass("EXLResultSelectedTab"),jQuery(currentTab).addClass("EXLResultSelectedTab"),n.find(".EXLResultTabContainer").hide(),currentTab.container.show(),!currentTab.container.data("loaded")||r.reload){var i='<div class="EXLTabHeaderContent">'+r.headerContent+'</div><div class="EXLTabHeaderButtons"><ul><li class="EXLTabHeaderButtonPopout"><a href="'+r.url+'" target="_blank"><img src="../images/icon_popout_tab.png" /></a></li><li></li><li class="EXLTabHeaderButtonCloseTabs"><a href="#" title="hide tabs"><img src="../images/icon_close_tabs.png" alt="hide tabs"></a></li></ul></div>',o='<div class="EXLTabHeader">'+i+"</div>",u='<div class="EXLTabContent">'+e+"</div>";currentTab.container.html(o+u),currentTab.container.data("loaded",!0)}}}return r}function f(e){var n=[],t=e.find(".EXLResultTab").length;for(k=0;t>k;k++)n.push(d(e,k));return null==n.addTab&&(n.addTab=function(n,t){t.record=e,p(n,t)}),n.getNames=function(){return tabNames=[],jQuery.each(n,function(){tabNames.push(this.name)}),tabNames},n.getEnabled=function(){return jQuery.map(e.tabs,function(n,t){return n=jQuery(n),"none"!=n.css("display")?e.tabs[t].name:null})},n.getByName=function(n){return d(e,n)},n}function p(e,n){defaults={record:null,state:"disabled",css:e.trim().toLowerCase().replace(/tab$/,"")+"Tab",url:"#",url_target:"",tooltip:"",label:e,headerContent:"",click:function(){alert("To be implemented...")}};var t=jQuery.extend(defaults,n);if(jQuery.inArray(e,t.record.tabs.getNames())<0){var r="exlidResult"+t.record.index+"-"+e,a='<li id="'+r+'" class="EXLResultTab '+t.css+'" name="'+e+'">';a+='  <span style="display:'+("disabled"==t.state?"block":"none")+'">'+t.label+"</span>",a+='  <a id="'+r+'Link" style="display:'+("disabled"==t.state?"none":"block")+'"',a+='     title="'+(t.tooltip||t.label)+'"',a+='     target="'+t.url_target+'"',a+='      href="'+t.url+'">'+t.label+"</a>",a+="</li>";var i='<div class="EXLResultTabContainer EXLContainer-'+t.css+'"></div>';t.record.find(".EXLResultTab").last().after(a),t.record.hasClass("EXLSummary")?t.record.append(i):t.record.find(".EXLSummary").append(i);var o="."+t.css+" a";null!==t.click&&t.record.find(o).click(function(n){n.preventDefault(),"enabled"==t.state&&(tab=t.record.tabs.getByName(e),t.click(n,tab,t.record,t))})}t.record.tabs=f(t.record)}function h(){function n(e,n){for(var t,r,a=/{{(.+?)}}/g,i=/(^( )?(var|if|for|else|switch|case|break|{|}|;))(.*)?/g,o="with(obj) { var r=[];\n",u=0,l=function(e,n){return o+=n?e.match(i)?e+"\n":"r.push("+e+");\n":""!=e?'r.push("'+e.replace(/"/g,'\\"')+'");\n':"",l};r=a.exec(e);)l(e.slice(u,r.index))(r[1],!0),u=r.index+r[0].length;l(e.substr(u,e.length-u)),o=(o+'return r.join(""); }').replace(/[\r\t\n]/g,"");try{t=new Function("obj",o).apply(n,[n])}catch(s){console.error("'"+s.message+"'"," in \n\nCode:\n",o,"\n")}return t}return{render:function(e,t){return n(e,t)},renderById:function(t,r){var a=e("#"+t).html();return n(a,r)}}}function b(n,t){function r(n,o){if(!n)return null;{var u="",l=null,s=null;n.nodeType,a(n.localName||n.nodeName),n.text||n.nodeValue||""}n.childNodes&&n.childNodes.length>0&&e.each(n.childNodes,function(e,n){var t=n.nodeType,o=a(n.localName||n.nodeName),s=n.text||n.nodeValue||"";if(8!=t)if(3!=t&&4!=t&&o)l=l||{},l[o]?(l[o].length||(l[o]=i(l[o])),l[o]=i(l[o]),l[o][l[o].length]=r(n,!0),l[o].length=l[o].length):l[o]=r(n);else{if(s.match(/^\s+$/))return;u+=s.replace(/^\s+/,"").replace(/\s+$/,"")}}),n.attributes&&n.attributes.length>0&&(s={},l=l||{},e.each(n.attributes,function(e,n){var t=a(n.name),r=n.value;s[t]=r,l[t]?(l[cnn]=i(l[cnn]),l[t][l[t].length]=r,l[t].length=l[t].length):l[t]=r})),l&&(l=e.extend(""!=u?new String(u):{},l||{}),u=l.text?[l.text||""].concat([u]):u,u&&(l.text=u),u="");var c=l||u;return t&&(u&&(c={}),u=c.text||u||"",u&&(c.text=u),o||(c=i(c))),c}if(!n)return{};var a=function(e){return String(e||"").replace(/-/g,"_")},i=function(n){return e.isArray(n)||(n=[n]),n.length=n.length,n};if("string"==typeof n&&(n=y(n)),n.nodeType){if(3==n.nodeType||4==n.nodeType)return n.nodeValue;var o=9==n.nodeType?n.documentElement:n,u=r(o,!0);return n=null,o=null,u}}function y(n){return e.parseXML(n)}function m(e){var n;return n=window.ActiveXObject?e.xml:(new XMLSerializer).serializeToString(e)}jQuery.PRIMO={parameters:{base_path:"/primo_library/libweb/jqprimo"}};var g=function(n,t){var r=null;return void 0===t&&(t="text"),jQuery.ajax({async:!1,type:"get",dataType:"xml",url:jQuery.PRIMO.parameters.base_path+"/helpers/record_helper.jsp?id="+n+".pnx"}).then(function(n,a,i){if(i.getResponseHeader("Content-Type").search(/xml/)>=0)switch(t){case"text":r=m(n);break;case"json":r=e(b(n));break;default:r=e(n)}else alert("PDS redirect detected. Do not know how to handle that, yet.")},function(){var a="/primo_library/libweb/action/display.do?vid="+jQuery.PRIMO.session.view.code+"&pds_handle=GUEST&doc="+n+"&showPnx=true";jQuery.ajax({async:!1,type:"get",dataType:"xml",url:a}).then(function(n,a,i){if(i.getResponseHeader("Content-Type").search(/xml/)>=0)switch(t){case"text":r=m(n);break;case"json":r=e(b(n));break;default:r=e(n)}else alert("PDS redirect detected. Do not know how to handle that, yet.")},function(e,n,t){alert("Unable to load record:"+t)})}),e.isArray(r)?r[0]:r},v=function(){var e=null;return{data:function(){return e||(e="unknown",jQuery.ajax({async:!1,type:"get",cache:!1,dataType:"text",url:jQuery.PRIMO.parameters.base_path+"/helpers/frontend_id",success:function(n){e=n.trim()},error:function(){e="unknown"}})),e}}}(),j=function(){var e=null;return{data:function(){return e||(e={},jQuery.ajax({async:!1,type:"get",cache:!1,dataType:"xml",url:"/primo_library/libweb/getUserInfoServlet",success:function(n){e.id=jQuery(n).find("userId").text(),e.name=jQuery(n).find("userName").text(),e.loggedIn="true"===jQuery(n).find("isLoggedIn").text()}})),e}}}(),T=function(){var n=null,t=function(){return n?void 0:(n={},jQuery.ajax({async:!1,type:"get",cache:!1,dataType:"json",url:jQuery.PRIMO.parameters.base_path+"/helpers/remote_session_data_helper.jsp",success:function(e){n=jQuery.extend(!0,{},e),n.user.isLoggedIn=function(){return e.user.isLoggedIn},n.user.isOnCampus=function(){return e.user.isOnCampus}},error:function(){n={view:{code:e("#vid").val()},user:{id:j.data().id,name:j.data().name,isLoggedIn:function(){return j.data().loggedIn}}}}}),e.extend(n.view,{isFullDisplay:function(){return window.isFullDisplay()},frontEndID:function(){return v.data()}()}),n.reload=function(){return n=null,jQuery.PRIMO.session=t(),n},"undefined"!=typeof window.performance&&"undefined"!=typeof window.performance.timing&&(n.performance={timing:{getNetworkLatency:function(){return performance.timing.responseEnd-performance.timing.fetchStart},getPageRender:function(){return performance.timing.loadEventEnd-performance.timing.responseEnd},getPageLoad:function(){return performance.timing.loadEventEnd-performance.timing.navigationStart}}}),n)};return t()};jQuery.extend(jQuery.PRIMO,{facets:n(),query:t(),records:function(){for(var n=[],t=jQuery(".EXLResult").length,a=0;t>a;a++)n.push(r(a));return e(n)}(),search:s(),session:T(),version:"0.0.13",reload:function(){jQuery.PRIMO.session.reload()},template:h()})}(jQuery);
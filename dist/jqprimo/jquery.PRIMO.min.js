!function(e){function t(e){var t=null,u=jQuery(jQuery(".EXLResult")[e]);return u.index=e,u.id=u.find(".EXLResultRecordId[name]").attr("name"),u.title=u.find(".EXLResultTitle").text().trim(),u.openUrl=u.find(".EXLMoreTab a").attr("href"),u.tabs=o(u),u.materialType=function(){return a(u)},u.getIt1=function(){return i(u)},u.getDedupedRecordIds=function(){return r(u.id).data()},u.isRemoteRecord=function(){return"TN"===u.id.substring(0,2)},u.isOnEShelf=function(){return-1!=u.find(".EXLMyShelfStar a").attr("href").search("fn=remove")},u.isDedupedRecord=function(){return n(u.id)},u.getData=function(){if(!t){var e=p(u.id,"json");e&&e.length>0&&(t=e[0])}return t},u.getPNX=function(e){return p(u.id,e)},u}function n(e){return-1!=e.search(/^dedupmrg/)}function r(e){var t=[];return{data:function(){return 0===t.length&&n(e)&&jQuery.ajax({async:!1,type:"get",dataType:"json",data:{id:e},url:jQuery.PRIMO.parameters.base_path+"/helpers/dedup_records_helper.jsp"}).done(function(e){t=e}).fail(function(){console.log("You need the dedup_records_helper.jsp file")}),t}}}function a(e){return e.getData().display.type}function i(t){var n=t.tabs.getByName("ViewOnline"),r="";return n&&n.length>0&&(r=e(n.find('input[id*="getitonline1"]')).val().split("O4=")[1].split("O5=")[0].replace(/delivery,.*?,/,"")),r}function u(){return{by_record_id:function(t,n){if(void 0===t)throw"You must supply a record id";var r=void 0!==n&&void 0!==n.institution?n.institution:jQuery.PRIMO.session.view.code,a=void 0!==n&&void 0!==n.index?n.index:1,i=void 0!==n&&void 0!==n.bulkSize?n.bulkSize:10,u=[];return jQuery.get("/PrimoWebServices/xservice/search/brief?institution="+r+"&query=rid,contains,"+t+"&indx="+a+"&bulkSize="+i).done(function(t){u=e(d(t))}).fail(function(){console.log("error searching")}),u},by_query:function(t,n){var r=void 0!==n&&void 0!==n.institution?n.institution:jQuery.PRIMO.session.view.code,a=void 0!==n&&void 0!==n.index?n.index:1,i=void 0!==n&&void 0!==n.bulkSize?n.bulkSize:10;Array.isArray(t)?jQuery.each(t,function(e,n){t=0/0+n}):t="&query="+t;var u=[];return jQuery.ajax({async:!1,type:"get",dataType:"xml",url:"/PrimoWebServices/xservice/search/brief?institution="+r+"&indx="+a+"&bulkSize="+i+t}).done(function(t){u=e(d(t))}).fail(function(){console.log("error searching")}),u.length>0&&u[0].hasOwnProperty("JAGROOT")?u[0].JAGROOT.RESULT.DOCSET.DOC:(u.length>0&&u[0].hasOwnProperty("MESSAGE")&&console.log(u[0].MESSAGE),null)}}}function s(t,n){var r=null;if("number"==typeof n?r=t.find(".EXLResultTab")[n]:"string"==typeof n&&(r=t.find('.EXLResultTab:contains("'+n+'")'),(null==r||0==r.length)&&(r=e(t.tabs).find('a[title*="'+n+'"]').parent()),(null==r||0==r.length)&&(r=e(t).find('li[class*="'+n+'"]'))),null!==r){var a=jQuery(r).find("a").text().trim(),i=null;jQuery.each(a.toLowerCase().replace(/\s/g,"").split("&"),function(){c=t.find('*[class*="Container-'+this+'"]'),c.length>0&&(i=c)}),r.index=n,r.name=a,r.container=i,r.isOpen=function(){return jQuery(r).hasClass("EXLResultSelectedTab")},r.close=function(){jQuery.PRIMO.session.view.isFullDisplay||(t.find(".EXLResultSelectedTab").removeClass("EXLResultSelectedTab"),t.find(".EXLTabsRibbon").addClass("EXLTabsRibbonClosed"),r.container.hide())},r.open=function(e,n){defaults={reload:!1,headerContent:"",url:"#"};var r=jQuery.extend(defaults,n);if(currentTab=t.tabs.getByName(a),t.find(".EXLTabsRibbonClosed").removeClass("EXLTabsRibbonClosed"),t.find(".EXLResultSelectedTab").removeClass("EXLResultSelectedTab"),jQuery(currentTab).addClass("EXLResultSelectedTab"),t.find(".EXLResultTabContainer").hide(),currentTab.container.show(),!currentTab.container.data("loaded")||r.reload){var i='<div class="EXLTabHeaderContent">'+r.headerContent+'</div><div class="EXLTabHeaderButtons"><ul><li class="EXLTabHeaderButtonPopout"><a href="'+r.url+'" target="_blank"><img src="../images/icon_popout_tab.png" /></a></li><li></li><li class="EXLTabHeaderButtonCloseTabs"><a href="#" title="hide tabs"><img src="../images/icon_close_tabs.png" alt="hide tabs"></a></li></ul></div>',u='<div class="EXLTabHeader">'+i+"</div>",s='<div class="EXLTabContent">'+e+"</div>";currentTab.container.html(u+s),currentTab.container.data("loaded",!0)}}}return r}function o(e){var t=[],n=e.find(".EXLResultTab").length;for(k=0;n>k;k++)t.push(s(e,k));return null==t.addTab&&(t.addTab=function(t,n){n.record=e,l(t,n)}),t.getNames=function(){return tabNames=[],jQuery.each(t,function(){tabNames.push(this.name)}),tabNames},t.getEnabled=function(){return jQuery.map(e.find(".EXLResultTab"),function(e){return e=jQuery(e),"none"!=e.css("display")?jQuery(e).text().trim():null})},t.getByName=function(t){return s(e,t)},t}function l(e,t){defaults={record:null,state:"disabled",css:e.replace(" ","").toLowerCase()+"Tab",url:"#",url_target:"",tooltip:"",headerContent:"",click:function(){alert("To be implemented...")}};var n=jQuery.extend(defaults,t);if(jQuery.inArray(e,n.record.tabs.getNames())<0){var r='<li class="EXLResultTab '+n.css+'">';r+='  <span style="display:'+("disabled"==n.state?"block":"none")+'">'+e+"</span>",r+='  <a style="display:'+("disabled"==n.state?"none":"block")+'"',r+='     title="'+n.tooltip+'"',r+='     target="'+n.url_target+'"',r+='      href="'+n.url+'">'+e+"</a>",r+="</li>";var a='<div class="EXLResultTabContainer EXLContainer-'+n.css+'"></div>';n.record.find(".EXLResultTab").last().after(r),n.record.hasClass("EXLSummary")?n.record.append(a):n.record.find(".EXLSummary").append(a);var i="."+n.css+" a";null!==n.click&&n.record.find(i).click(function(t){t.preventDefault(),"enabled"==n.state&&(tab=n.record.tabs.getByName(e),n.click(t,tab,n.record,n))})}n.record.tabs=o(n.record)}function d(t,n){function r(t,u){if(!t)return null;{var s="",o=null,l=null;t.nodeType,a(t.localName||t.nodeName),t.text||t.nodeValue||""}t.childNodes&&t.childNodes.length>0&&e.each(t.childNodes,function(e,t){var n=t.nodeType,u=a(t.localName||t.nodeName),l=t.text||t.nodeValue||"";if(8!=n)if(3!=n&&4!=n&&u)o=o||{},o[u]?(o[u].length||(o[u]=i(o[u])),o[u]=i(o[u]),o[u][o[u].length]=r(t,!0),o[u].length=o[u].length):o[u]=r(t);else{if(l.match(/^\s+$/))return;s+=l.replace(/^\s+/,"").replace(/\s+$/,"")}}),t.attributes&&t.attributes.length>0&&(l={},o=o||{},e.each(t.attributes,function(e,t){var n=a(t.name),r=t.value;l[n]=r,o[n]?(o[cnn]=i(o[cnn]),o[n][o[n].length]=r,o[n].length=o[n].length):o[n]=r})),o&&(o=e.extend(""!=s?new String(s):{},o||{}),s=o.text?[o.text||""].concat([s]):s,s&&(o.text=s),s="");var d=o||s;return n&&(s&&(d={}),s=d.text||s||"",s&&(d.text=s),u||(d=i(d))),d}if(!t)return{};var a=function(e){return String(e||"").replace(/-/g,"_")},i=function(t){return e.isArray(t)||(t=[t]),t.length=t.length,t};if("string"==typeof t&&(t=f(t)),t.nodeType){if(3==t.nodeType||4==t.nodeType)return t.nodeValue;var u=9==t.nodeType?t.documentElement:t,s=r(u,!0);return t=null,u=null,s}}function f(t){return e.parseXML(t)}function y(e){var t;return t=window.ActiveXObject?e.xml:(new XMLSerializer).serializeToString(e)}jQuery.PRIMO={parameters:{base_path:"/primo_library/libweb/jqprimo"}};var p=function(t,n){var r=null;return void 0===n&&(n="text"),jQuery.ajax({async:!1,type:"get",dataType:"xml",url:jQuery.PRIMO.parameters.base_path+"/helpers/record_helper.jsp?id="+t+".pnx",success:function(t,a,i){if(i.getResponseHeader("Content-Type").search(/xml/)>=0)switch(n){case"text":r=y(t);break;case"json":r=e(d(t));break;default:r=e(t)}else alert("PDS redirect detected. Do not know how to handle that, yet.")},error:function(){jQuery.ajax({async:!1,type:"get",dataType:"xml",url:"/primo_library/libweb/action/display.do?vid="+jQuery.PRIMO.session.view.code+"&showPnx=true&pds_handle=GUEST&doc="+t,success:function(t,a,i){if(i.getResponseHeader("Content-Type").search(/xml/)>=0)switch(n){case"text":r=y(t);break;case"json":r=e(d(t));break;default:r=e(t)}else alert("PDS redirect detected. Do not know how to handle that, yet.")}})}}),e.isArray(r)?r[0]:r},b=function(){var e=null;return{data:function(){return e||(e="unknown",jQuery.ajax({async:!1,type:"get",dataType:"text",url:jQuery.PRIMO.parameters.base_path+"/helpers/frontend_id",success:function(t){e=t.trim()},error:function(){e="unknown"}})),e}}}(),h=function(){var e=null;return{data:function(){return e||(e={},jQuery.ajax({async:!1,type:"get",dataType:"xml",url:"/primo_library/libweb/getUserInfoServlet",success:function(t){e.id=jQuery(t).find("userId").text(),e.name=jQuery(t).find("userName").text(),e.loggedIn="true"===jQuery(t).find("isLoggedIn").text()}})),e}}}(),g=function(){var t=null,n=function(){return t?void 0:(t={},jQuery.ajax({async:!1,type:"get",dataType:"json",url:jQuery.PRIMO.parameters.base_path+"/helpers/remote_session_data_helper.jsp",success:function(e){t=jQuery.extend(!0,{},e),t.user.isLoggedIn=function(){return e.user.isLoggedIn},t.user.isOnCampus=function(){return e.user.isOnCampus}},error:function(){t={view:{code:e("#vid").val()},user:{id:h.data().id,name:h.data().name,isLoggedIn:function(){return h.data().loggedIn}}}}}),e.extend(t.view,{isFullDisplay:function(){return window.isFullDisplay()},frontEndID:function(){return b.data()}()}),t.reload=function(){return t=null,jQuery.PRIMO.session=n(),t},t)};return n()};jQuery.extend(jQuery.PRIMO,{session:g(),records:function(){for(var n=[],r=jQuery(".EXLResult").length,a=0;r>a;a++)n.push(t(a));return e(n)}(),search:u(),version:"0.0.7",reload:function(){jQuery.PRIMO.session.reload()}})}(jQuery);